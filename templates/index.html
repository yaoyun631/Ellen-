{% extends "base.html" %}
{% block title %}Ellenå¸¶ä½ æ‰¾å®¶{% endblock %}
{% block content %}
<!-- è¼ªæ’­åœ–ç‰‡ -->
<div id="carouselExample" class="carousel slide mb-4" data-bs-ride="carousel">
  <div class="carousel-inner">
    {% for img in slide_images %}
    <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %}">
      <img src="{{ url_for('static', filename='images/carousel/' ~ img) }}"
           class="d-block w-100"
           style="height: 500px; object-fit: cover;"
           alt="Slide {{ loop.index }}">
    </div>
    {% endfor %}
  </div>
</div>

<!-- ğŸ”¥ Ellen å¼·éŠ·ç‰©ä»¶å€å¡Š -->
{% if featured_data %}
<div class="my-5">
  <h2 class="mb-3" style="color: #a3570a;">ğŸ”¥ Ellen å¼·éŠ·å°ˆå€</h2>
  <div class="position-relative">
    <!-- å·¦ç®­é ­ -->
    <button id="leftArrow" class="btn btn-outline-secondary position-absolute top-50 start-0 translate-middle-y z-1" onclick="scrollFeatured(-1)">
      â€¹
    </button>

    <!-- å¯æ©«å‘æ»¾å‹•çš„å®¹å™¨ -->
    <div id="featuredScrollContainer" class="d-flex overflow-auto" style="scroll-behavior: smooth; scrollbar-width: none; -ms-overflow-style: none;">
      <style>
        #featuredScrollContainer::-webkit-scrollbar {
          display: none;
        }
      </style>
      {% for row in featured_data %}
      <div class="card me-3 shadow-sm border-danger" style="min-width: 260px; flex: 0 0 auto;">
        <a href="{{ row.ç¶²å€ or '#' }}" target="_blank" style="text-decoration:none; color:inherit;">
          <img src="{{ row.image_url or url_for('static', filename='images/logo.png') }}"
               class="card-img-top"
               style="object-fit: cover; height: 180px;" alt="åœ–ç‰‡">
          <div class="card-body">
            <h5 class="card-title">{{ row["\u623f\u5c4b\u6a19\u984c"] or row["\u5730\u5740"] }}</h5>
            <div style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">
              {{ row.å€åŸŸ or '-' }} | {{ row.æˆ¿å‹ or '-' }}
            </div>
            <div style="font-weight: 500; font-size: 0.9rem; color: #333; margin-bottom: 1rem;">
              {% if row.å±‹é½¡ is number %}{{ row.å±‹é½¡|int }}å¹´{% else %}-{% endif %} | 
              {% if row.ç™¼é€å¹³æ•¸ is number %}{{ row.ç™¼é€å¹³æ•¸|round(1) }}åª{% else %}-{% endif %} |
              {{ row.æˆ¿å»³è¡› or '-' }}
            </div>
            <div style="font-weight: 700; font-size: 1.3rem;">
              <span style="color: red; font-size: 1.6rem;">
                {% if row.å§”è¨—ç¸½åƒ¹ is number %}
                  {{ row.å§”è¨—ç¸½åƒ¹|int }}
                {% else %}
                  ç„¡è³‡æ–™
                {% endif %}
              </span>
              <span style="margin-left: 2px;">è¬</span>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>

    <!-- å³ç®­é ­ -->
    <button id="rightArrow" class="btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y z-1" onclick="scrollFeatured(1)">
      â€º
    </button>
  </div>
</div>
{% endif %}

<!-- ğŸ” Ellen å¼·éŠ·æ»‘å‹•å€å¡Š JavaScript -->
<script>
  const container = document.getElementById('featuredScrollContainer');
  const leftArrow = document.getElementById('leftArrow');
  const rightArrow = document.getElementById('rightArrow');

  function updateArrowVisibility() {
    const maxScrollLeft = container.scrollWidth - container.clientWidth;
    leftArrow.style.display = container.scrollLeft > 0 ? 'block' : 'none';
    rightArrow.style.display = container.scrollLeft < maxScrollLeft ? 'block' : 'none';
  }

  function scrollFeatured(direction) {
    const card = container.querySelector('.card');
    if (!card) return;
    const cardWidth = card.offsetWidth + parseInt(getComputedStyle(card).marginRight);
    const scrollAmount = cardWidth * 4;

    container.scrollBy({
      left: direction * scrollAmount,
      behavior: 'smooth'
    });

    setTimeout(updateArrowVisibility, 600);
  }

  window.addEventListener('load', updateArrowVisibility);
  container.addEventListener('scroll', updateArrowVisibility);

  setInterval(() => {
    const maxScrollLeft = container.scrollWidth - container.clientWidth;
    if (container.scrollLeft >= maxScrollLeft - 10) {
      container.scrollTo({ left: 0, behavior: 'smooth' });
    } else {
      scrollFeatured(1);
    }
  }, 5000);
</script>

<!-- æŸ¥è©¢è¡¨å–® -->
<div class="p-4 mb-5" style="background-color: #CABAA1; border: 1px solid #eee; border-radius: 8px;">
  <h2 class="mb-4">ğŸ  ç‰©ä»¶æŸ¥è©¢</h2>
  <form method="GET" id="searchForm">
    <div class="row g-3">
      <!-- å€åŸŸå‹¾é¸ -->
      <div class="col-12">
        <label class="form-label">å€åŸŸ</label><br />
        <label class="me-3">
          <input type="checkbox" id="area_all" onchange="toggleAll(this)"> å…¨éƒ¨
        </label>
        {% for d in taichung_districts %}
        <label class="me-3">
          <input type="checkbox" name="areas" value="{{ d }}" {% if d in selected_areas %}checked{% endif %}> {{ d }}
        </label>
        {% endfor %}
        <label class="me-3">
          <input type="checkbox" name="areas" value="å…¶ä»–" {% if 'å…¶ä»–' in selected_areas %}checked{% endif %}> å…¶ä»–
        </label>
      </div>

      <!-- æˆ¿å‹ -->
      <div class="col-12 mt-3">
        <label class="form-label">æˆ¿å‹</label><br />
        {% for t in æˆ¿å‹é¸é … %}
        <label class="me-2">
          <input type="checkbox" name="types" value="{{ t }}" {% if t in selected_types %}checked{% endif %}> {{ t }}
        </label>
        {% endfor %}
      </div>

      <!-- æ ¼å±€ -->
      <div class="col-6 col-md-2">
        <label for="room_min" class="form-label">æ ¼å±€æœ€å°(æˆ¿)</label>
        <input type="number" step="1" min="0" name="room_min" id="room_min" class="form-control" value="{{ room_min }}">
      </div>
      <div class="col-6 col-md-2">
        <label for="room_max" class="form-label">æ ¼å±€æœ€å¤§(æˆ¿)</label>
        <input type="number" step="1" min="0" name="room_max" id="room_max" class="form-control" value="{{ room_max }}">
      </div>

      <!-- ç¸½åƒ¹ -->
      <div class="col-6 col-md-2">
        <label for="price_min" class="form-label">ç¸½åƒ¹æœ€å°(è¬)</label>
        <input type="number" step="0.1" min="0" name="price_min" id="price_min" class="form-control" value="{{ price_min }}">
      </div>
      <div class="col-6 col-md-2">
        <label for="price_max" class="form-label">ç¸½åƒ¹æœ€å¤§(è¬)</label>
        <input type="number" step="0.1" min="0" name="price_max" id="price_max" class="form-control" value="{{ price_max }}">
      </div>

      <!-- é—œéµå­— -->
      <div class="col-12 col-md-6">
        <label for="keyword" class="form-label">é—œéµå­—ï¼ˆåœ°å€ï¼‰</label>
        <input type="text" name="keyword" id="keyword" class="form-control" value="{{ keyword }}">
      </div>

      
              <!-- æ’åºæ¬„ä½ -->
      <div class="col-md-3">
        <label for="sort_by" class="form-label">æ’åºæ¬„ä½</label>
        <select name="sort_by" id="sort_by" class="form-select">
          <option value="å§”è¨—ç¸½åƒ¹" {% if sort_by == "å§”è¨—ç¸½åƒ¹" %}selected{% endif %}>ç¸½åƒ¹</option>
          <option value="æˆ¿é–“æ•¸" {% if sort_by == "æˆ¿é–“æ•¸" %}selected{% endif %}>æ ¼å±€(æˆ¿æ•¸)</option>
          <option value="å±‹é½¡" {% if sort_by == "å±‹é½¡" %}selected{% endif %}>å±‹é½¡</option>
          <option value="ç™»è¨˜åªæ•¸" {% if sort_by == "ç™»è¨˜åªæ•¸" %}selected{% endif %}>ç™»è¨˜åªæ•¸</option>
        </select>
      </div>

      <!-- æ’åºæ–¹å‘ -->
      <div class="col-md-3">
        <label for="sort_order" class="form-label">æ’åºæ–¹å‘</label>
        <select name="sort_order" id="sort_order" class="form-select">
          <option value="desc" {% if sort_order == "desc" %}selected{% endif %}>ç”±å¤§åˆ°å°</option>
          <option value="asc" {% if sort_order == "asc" %}selected{% endif %}>ç”±å°åˆ°å¤§</option>
        </select>
      </div>
      <div class="col-12 text-center">
        <button type="submit" class="btn mt-3" style="background-color: #fa782a; color: white; border: none;">
          æŸ¥è©¢
        </button>
      </div>
    </div>
  </form>
</div>

<p>ç¬¦åˆæ¢ä»¶è³‡æ–™ç­†æ•¸ï¼š{{ total_records }}</p>

<!-- å³ä¸Šè§’é¡¯ç¤ºæ¨¡å¼åˆ‡æ› -->
<div style="position: fixed; top: 90px; right: 20px; z-index: 1000;">
  <button id="toggleViewBtn" class="btn btn-outline-dark btn-lg" title="åˆ‡æ›é¡¯ç¤ºæ¨¡å¼" style="font-size: 1.5rem; font-weight: bold;">
    #
  </button>
</div>




<style>
  /* æ•´åˆ—æ»‘é¼ ç§»å‹•æ™‚åœ–ç‰‡æœ‰æ”¾å¤§é™°å½± */
  .card-horizontal:hover img {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: scale(1.02);
    transition: box-shadow 0.3s, transform 0.3s;
  }

  /* é è¨­åœ–ç‰‡éæ¸¡æ•ˆæœ */
  .card-horizontal img {
    transition: box-shadow 0.3s, transform 0.3s;
  }

  /* åªæœ‰æ¨™é¡Œæ»‘é¼ ç§»å‹•æ™‚æ‰æœ‰åº•ç·š */
  .card-horizontal h5:hover {
    text-decoration: underline;
    transition: text-decoration 0.2s;
    cursor: pointer;
  }
</style>



<!-- æ–¹æ ¼é¡¯ç¤ºå€ -->
<div id="gridView" class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4" style="display:none;">
  {% for row in data %}
  <div class="col">
    <a href="{{ row.ç¶²å€ or '#' }}" target="_blank" style="text-decoration:none; color:inherit;">
      <div class="card h-100 shadow-sm">
        <img src="{{ row.image_url or url_for('static', filename='images/logo.png') }}" class="card-img-top" alt="åœ–ç‰‡" style="object-fit: cover; height: 180px;">
        <div class="card-body d-flex flex-column">
          <h3 style="font-family: å¾®è»Ÿæ­£é»‘é«” Light; font-weight: bold; font-size: 1.25rem; margin-bottom: 0.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ row['æˆ¿å±‹æ¨™é¡Œ'] or row['åœ°å€'] }}">
  {{ row['æˆ¿å±‹æ¨™é¡Œ'] or row['åœ°å€'] }}
</h3>

          <div class="caption" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">
            {{ row.å€åŸŸ or '-' }} | {{ row.æˆ¿å‹ or '-' }}
          </div>
          <div class="title" style="font-weight: 500; font-size: 0.9rem; color: #333; margin-bottom: 1rem;">
            {% if row.å±‹é½¡ is number %}
              {{ row.å±‹é½¡|int }}å¹´
            {% else %}
              -
            {% endif %} | 
            {% if row.ç™»è¨˜åªæ•¸ is number %}
              {{ row.ç™»è¨˜åªæ•¸|round(1) }}åª
            {% else %}
              -
            {% endif %}
            | {{ row.æˆ¿å»³è¡› or '-' }}
          </div>
          <div class="mt-auto d-flex justify-content-end align-items-end">
            <span style="font-weight: 700; font-size: 1.3rem;">
              <span style="color: red; font-size: 1.6rem;">
                {% if row.å§”è¨—ç¸½åƒ¹ is number %}
                  {{ row.å§”è¨—ç¸½åƒ¹|int }}
                {% else %}
                  ç„¡è³‡æ–™
                {% endif %}
              </span>
              <span style="color: inherit; font-size: 1.3rem; margin-left: 2px;">è¬</span>
            </span>
          </div>
        </div>
      </div>
    </a>
  </div>
  {% endfor %}
</div>

<!-- è¡¨æ ¼é¡¯ç¤ºå€ -->
<div id="cardListView">
  {% for row in data %}
  <div class="card-horizontal p-3 border-top border-bottom bg-white"
       style="display: flex; margin: 0; border-left: none; border-right: none; border-radius: 0; cursor: pointer;"
       onclick="window.open('{{ row.ç¶²å€ or '#' }}', '_blank')">

    <!-- åœ–ç‰‡ -->
    <div style="flex-shrink: 0;">
      <img src="{{ row.image_url or url_for('static', filename='images/logo.png') }}"
           alt="åœ–ç‰‡"
           style="width: 200px; height: 150px; object-fit: cover; border-radius: 4px;">
    </div>

    <!-- è³‡è¨Šå€å¡Š -->
    <div style="flex-grow: 1; padding-left: 12px;">
      <!-- æ¨™é¡Œ -->
      <h5 class="mb-1"
          style="font-size: 1.5rem; font-weight: bold;">
        {{ row['æˆ¿å±‹æ¨™é¡Œ'] or row['åœ°å€'] }}
      </h5>

      <div style="color: #444; font-size: 1rem;">
        <span style="margin-right: 8px;">{{ row['æˆ¿å‹'] or '-' }}</span><span style="margin-right: 16px;">|</span>
        <span style="margin-right: 8px;">{{ row['æˆ¿å»³è¡›'] or '-' }}</span><span style="margin-right: 16px;">|</span>
        <span style="margin-right: 8px;">ç™»è¨˜åªæ•¸ {{ row['ç™»è¨˜åªæ•¸'] or '-' }}åª</span><span style="margin-right: 16px;">|</span>
        <span style="margin-right: 8px;">ä¸»å»º {{ row['ä¸»å»ºç‰©åª'] or '-' }}åª</span><span style="margin-right: 16px;">|</span>
        <span style="margin-right: 8px;">å±‹é½¡ {{ row['å±‹é½¡'] or '-' }}å¹´</span><span style="margin-right: 16px;">|</span>
        <span style="margin-right: 8px;">æ¨“å±¤ {{ row['æ¨“åˆ¥/æ¨“é«˜'] or '-' }}</span><span style="margin-right: 16px;">|</span>
        <span style="margin-right: 8px;">{{ row['è»Šä½å‹å¼'] or '-' }}</span>
      </div>

      <div style="font-size: 1.1rem; color: gray;">
        {{ row['å€åŸŸ'] or '-' }} - {{ row['åœ°å€'] or '' }}
      </div>
    </div>

    <!-- åƒ¹æ ¼å€ -->
    <div style="flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-width: 100px;">
      <div style="font-size: 1.6rem; font-weight: bold; color: red;">
        {% if row.å§”è¨—ç¸½åƒ¹ is number %}
          {{ row.å§”è¨—ç¸½åƒ¹|int }} è¬
        {% else %}
          -
        {% endif %}
      </div>
      <div style="font-size: 0.85rem; color: #888;">
        {% if row['å–®åƒ¹'] is number %}
          {{ row['å–®åƒ¹']|round(2) }} è¬/åª
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>



<!-- åˆ†é æŒ‰éˆ• -->
<nav aria-label="Page navigation example" class="mt-4 d-flex justify-content-center align-items-center gap-3">
  <button class="btn btn-outline-primary" id="prevBtn" {% if page <= 1 %}disabled{% endif %} onclick="changePage({{ page -1 }})">ä¸Šä¸€é </button>
  <span>ç¬¬ {{ page }} é  / å…± {{ total_pages }} é </span>
  <button class="btn btn-outline-primary" id="nextBtn" {% if page >= total_pages %}disabled{% endif %} onclick="changePage({{ page +1 }})">ä¸‹ä¸€é </button>
</nav>

<script>
  // åˆ‡æ›å…¨éƒ¨å€åŸŸå‹¾é¸
  function toggleAll(source) {
    const checkboxes = document.querySelectorAll('input[name="areas"]');
    checkboxes.forEach(cb => {
      cb.checked = source.checked;
    });
  }


    // åˆ‡æ›é¡¯ç¤ºæ¨¡å¼
  const toggleBtn = document.getElementById('toggleViewBtn');
  const cardListView = document.getElementById('cardListView');
  const gridView = document.getElementById('gridView');

  // åˆå§‹é¡¯ç¤ºæ¨¡å¼ï¼Œå¯ç”¨ localStorage ç´€éŒ„
  let isTableView = localStorage.getItem('isTableView');
  if (isTableView === null) {
    isTableView = true; // é è¨­è¡¨æ ¼é¡¯ç¤º
  } else {
    isTableView = (isTableView === 'true');
  }
  updateView();

  toggleBtn.addEventListener('click', () => {
    isTableView = !isTableView;
    localStorage.setItem('isTableView', isTableView);
    updateView();
  });
function updateView() {
  const toggleBtn = document.getElementById("toggleViewBtn");

  if (isTableView) {
    cardListView.style.display = 'block';
    gridView.style.display = 'none';
    toggleBtn.textContent = "å¡ç‰‡";

    // å­—é«”è®Šå°ï¼ˆé‡å° cardListViewï¼‰
    cardListView.style.fontSize = '0.5rem';
  } else {
    cardListView.style.display = 'none';
    gridView.style.display = 'flex';
    toggleBtn.textContent = "åˆ—è¡¨";

    // å­—é«”è®Šå°ï¼ˆé‡å° gridViewï¼‰
    gridView.style.fontSize = '0.5rem';
  }
}
ã„’



  // åˆ†é è·³è½‰ï¼ˆæ”¹æˆç›´æ¥è·³ç¶²å€ï¼Œé¿å… method not allowedï¼‰
  function changePage(targetPage) {
    const url = new URL(window.location);
    url.searchParams.set("page", targetPage);
    window.location.href = url.toString();
  }

  
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">


{% endblock %}
